<html>
    <head>
        <meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="./CSS/Style.css">
        <link rel="stylesheet" href="./CSS/Font.css">
        <script src="JavaScript/WebSocket.js"></script>
        <script src="JavaScript/BookManager.js"></script>
        <title>Controller</title>
    </head>
    <body>
        <div id="TopContainer">
            <div id="LogoContainer">
                <a href="Main.php"><img src="./Images/GJU_Logo.png"></a>
            </div>
            <div id="RobotStateContainer">
                <img src="./Images/Robot.png">
                <span>ì‚¬ìš© ê°€ëŠ¥</span>
            </div>
        </div>
        <br>
        <div class="center">
            <!-- <?php
                // BarcodeScan.phpì—ì„œ isbnì´ ìŠ¤ìº” ëì„ ë•Œ
                $barcodeISBN = $_GET['scanValue'];

                // if(!isset($barcodeISBN)){
                //     echo "<br>!!!! ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ISBN ê°’ !!!!";
                // }
                // else{
                //     // BarcodeScan.php ì—ì„œ ìŠ¤ìº”í–ˆì„ ë•Œ ê°’ ë°›ì•„ì™€ì„œ ì²˜ë¦¬í•  ê²ƒ
                //     echo "<br>ë¡œë´‡ì´ ìŠ¤ìº”í•œ ISBN ë²ˆí˜¸: " . $barcodeISBN;
                // }
                // ë¶ ë°ì´í„° ê°€ì ¸ì˜¤ëŠ” ë¡œì§ ( ì„ì‹œ )
                if($selectBookISBN != null || $barcodeISBN != null){
                    $ISBN = $selectBookISBN != null ? $selectBookISBN : $barcodeISBN;
                }

                if ($ISBN !== null) {
                    
                    // íŒŒì´ì¬ìœ¼ë¡œ ìš”ì²­ ë³´ë‚´ê¸°
                    $paythonScriptName = "MainController.py";
                    $pythonScriptPath = __DIR__ . "/" . $paythonScriptName;
                    $command = "python " . $pythonScriptPath . " " . $ISBN . " 2>&1"; 
                    $output = array();
                    $returnVar;
                    exec($command, $output, $returnVar);
                    $ISBN = implode("\n", $output);
                    if ($returnVar === 0) {
                        // // ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰ëœ ê²½ìš°
                        // $outputString = implode("\n", $output);
                        // echo "<br>" . $outputString;
                        // $decodedString = stripcslashes($outputString);
                        $conn = oci_connect('dbuser192352', 'robot', 'azza.gwangju.ac.kr/orcl', 'AL32UTF8');

                        $query = "SELECT TITLE, AUTHOR, PUB, PUB_YEAR, SHELF_LOCATION || ' ì±…ì¥' as SHELF_LOCATION
                                    FROM BOOKS
                                    INNER JOIN BOOK_LOCATION
                                    ON BOOKS.ISBN = BOOK_LOCATION.ISBN
                                    WHERE BOOKS.ISBN = :isbn";
                        $stmt = oci_parse($conn, $query);
                        oci_bind_by_name($stmt, ":isbn", $ISBN);
                        oci_execute($stmt);
                        echo "<div id='bookDiv'>";
                        if ($row = oci_fetch_assoc($stmt)) {
                            echo "<h2 id='bookTitle'>ğŸ“– {$row['TITLE']}</h2>
                                    <p><span id='bookAuthor'>ğŸ”– ì €ì ï½œ {$row['AUTHOR']}</span></p>
                                    <p><span id='bookPub'>ğŸ”– ì¶œíŒì‚¬ ï½œ {$row['PUB']}</span></p>
                                    <p><span id='bookPubYear'>ğŸ”– ì¶œíŒë…„ë„ ï½œ {$row['PUB_YEAR']}</span></p>
                                    <p><span id='bookLocation'>ğŸŒ ì±… ìœ„ì¹˜ ï½œ {$row['SHELF_LOCATION']}</span></p>";
                        }
                        echo "</div>";
                        oci_free_statement($stmt);
                        oci_close($conn);

                    }
                    else {
                        // ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí•œ ê²½ìš°
                        echo "<br>"."ì˜¤ë¥˜ ë°œìƒ. ë°˜í™˜ ì½”ë“œ: " . $returnVar;
                        echo "<br>". "ì˜¤ë¥˜ ë©”ì‹œì§€: " . implode("\n", $output);
                    }
                }


                // í˜¹ì‹œ ëª¨ë¥´ë‹ˆ ì´ˆê¸°í™”ë¡œ ì˜ˆì™¸ì²˜ë¦¬
                $selectBookISBN = $barcodeISBN = null;
            ?> -->
        </div>
    </body>
</html>